<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Uncensored News - Real-time updates on Much Love, No Fear">
    <title>News - Much Love, No Fear</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../css/viking-components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="container">
            <div class="flex flex-between">
                <div class="site-logo">
                    <i class="fas fa-shield-alt site-logo-icon"></i>
                    <span>Much Love, No Fear</span>
                </div>
                
                <nav class="site-nav" id="mainNav">
                    <a href="../index.html" class="nav-link">Home</a>
                    <a href="live.html" class="nav-link">Live</a>
                    <a href="archive.html" class="nav-link">Love Vault</a>
                    <a href="blog.html" class="nav-link">Blog</a>
                    <a href="news.html" class="nav-link active">News</a>
                    <a href="messageboard.html" class="nav-link">Board</a>
                    <a href="donations.html" class="nav-link">Support</a>
                    <a href="merch.html" class="nav-link">Merch</a>
                    <a href="auth.html" class="nav-link" id="authLink">Login</a>
                    <a href="../dashboard.html" class="nav-link hidden" id="dashboardLink">Dashboard</a>
                    
                    <!-- Notification Bell -->
                    <div class="notification-bell hidden" id="notificationBell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge hidden" id="notificationBadge">0</span>
                    </div>
                    
                    <!-- Theme Toggle -->
                    <button class="btn-icon" id="themeToggle" title="Toggle theme">
                        <i class="fas fa-moon"></i>
                    </button>
                </nav>
                
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Page Hero -->
    <section class="page-hero" style="background: linear-gradient(135deg, var(--peach) 0%, var(--navy) 100%); padding: 3rem 0; color: var(--cream);">
        <div class="container">
            <h1 style="color: var(--gold); text-shadow: 2px 2px 8px rgba(0,0,0,0.5);">
                <i class="fas fa-newspaper"></i> Uncensored News
            </h1>
            <p style="font-size: 1.25rem; margin-top: 1rem;">
                Real-time updates from independent journalists and citizen reporters
            </p>
        </div>
    </section>

    <!-- Breaking News Ticker -->
    <section style="background: var(--error); color: white; padding: 1rem 0;">
        <div class="container">
            <div class="flex gap-md">
                <span class="badge badge-light" style="background: white; color: var(--error);">
                    <i class="fas fa-bolt"></i> BREAKING
                </span>
                <div class="news-ticker" style="flex: 1; overflow: hidden;">
                    <span id="tickerText" style="display: inline-block; white-space: nowrap; animation: scroll-left 30s linear infinite;">
                        Major whistleblower reveals government surveillance program ‚Ä¢ Alternative health breakthrough censored by mainstream media ‚Ä¢ Financial markets show signs of manipulation ‚Ä¢ New evidence emerges in controversial case
                    </span>
                </div>
            </div>
        </div>
    </section>

    <!-- News Categories -->
    <section style="padding: 2rem 0; background: var(--gray-50);">
        <div class="container">
            <div class="flex gap-md flex-wrap">
                <button class="btn btn-outline active" data-category="all">All News</button>
                <button class="btn-viking-secondary" data-category="breaking">Breaking</button>
                <button class="btn-viking-secondary" data-category="world">World</button>
                <button class="btn-viking-secondary" data-category="health">Health</button>
                <button class="btn-viking-secondary" data-category="finance">Finance</button>
                <button class="btn-viking-secondary" data-category="tech">Technology</button>
                <button class="btn-viking-secondary" data-category="politics">Politics</button>
                <button class="btn-viking-secondary" id="submitNewsBtn">
                    <i class="fas fa-plus-circle"></i> Submit News
                </button>
            </div>
        </div>
    </section>

    <!-- Main News Layout -->
    <section style="padding: 3rem 0;">
        <div class="container">
            <div class="grid news-layout-grid" style="gap: 2rem;">
                <!-- Main News Feed -->
                <div>
                    <!-- Featured Story -->
                    <article class="card card-viking mb-3">
                        <div class="card-body">
                            <div class="badge badge-error mb-2">BREAKING</div>
                            <h2 class="mb-2">Leaked Documents Reveal Mass Censorship Coordination</h2>
                            <div class="flex gap-md text-muted mb-3">
                                <span><i class="fas fa-user"></i> Independent Reporter</span>
                                <span><i class="fas fa-clock"></i> 2 hours ago</span>
                                <span><i class="fas fa-eye"></i> 45.2k views</span>
                            </div>
                            <img src="https://via.placeholder.com/400x300/FF6B6B/FFFFFF?text=News+Image" alt="News" style="width: 100%; height: 300px; object-fit: cover; border-radius: var(--radius-md); margin-bottom: 1rem;">
                            <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 1rem;">
                                Explosive new documents obtained by independent journalists reveal a coordinated effort between Big Tech companies and government agencies to suppress dissenting voices across all major platforms. The documents, which span over 1000 pages, detail specific targeting criteria and automated censorship systems...
                            </p>
                            <div class="flex flex-between">
                                <a href="#" class="btn-viking-primary">Read Full Story</a>
                                <div class="flex gap-md">
                                    <button class="btn btn-outline btn-sm"><i class="fas fa-share"></i> Share</button>
                                    <button class="btn btn-outline btn-sm"><i class="fas fa-bookmark"></i> Save</button>
                                </div>
                            </div>
                        </div>
                    </article>

                    <!-- News List -->
                    <div class="news-list" id="newsFeed">
                        <!-- News articles will load here dynamically from API -->
                    </div>

                    <!-- Load More -->
                    <div class="text-center mt-3">
                        <button class="btn btn-viking btn-lg">
                            <i class="fas fa-plus-circle"></i> Load More News
                        </button>
                    </div>
                </div>

                <!-- Sidebar -->
                <aside>
                    <!-- Trending Topics -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <h3 class="mb-3"><i class="fas fa-fire text-peach"></i> Trending Topics</h3>
                            <ul style="list-style: none;">
                                <li class="mb-2">
                                    <a href="#" class="flex flex-between">
                                        <span>#GreatAwakening</span>
                                        <span class="badge badge-secondary">45.2k</span>
                                    </a>
                                </li>
                                <li class="mb-2">
                                    <a href="#" class="flex flex-between">
                                        <span>#NaturalImmunity</span>
                                        <span class="badge badge-secondary">32.8k</span>
                                    </a>
                                </li>
                                <li class="mb-2">
                                    <a href="#" class="flex flex-between">
                                        <span>#FinancialReset</span>
                                        <span class="badge badge-secondary">28.5k</span>
                                    </a>
                                </li>
                                <li class="mb-2">
                                    <a href="#" class="flex flex-between">
                                        <span>#FreeSpeech</span>
                                        <span class="badge badge-secondary">24.1k</span>
                                    </a>
                                </li>
                                <li class="mb-2">
                                    <a href="#" class="flex flex-between">
                                        <span>#Decentralization</span>
                                        <span class="badge badge-secondary">19.7k</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Most Discussed -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <h3 class="mb-3"><i class="fas fa-comments text-indigo"></i> Most Discussed</h3>
                            <div class="mb-3">
                                <h5 class="mb-1">WHO Treaty Leaked: Shocking Details</h5>
                                <div class="text-muted" style="font-size: 0.875rem;">
                                    <span><i class="fas fa-comment"></i> 2.3k comments</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <h5 class="mb-1">Alternative Energy Breakthrough Suppressed</h5>
                                <div class="text-muted" style="font-size: 0.875rem;">
                                    <span><i class="fas fa-comment"></i> 1.8k comments</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <h5 class="mb-1">Banking System on Verge of Collapse?</h5>
                                <div class="text-muted" style="font-size: 0.875rem;">
                                    <span><i class="fas fa-comment"></i> 1.5k comments</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit News Tip -->
                    <div class="card card-viking">
                        <div class="card-body text-center">
                            <i class="fas fa-bullhorn" style="font-size: 3rem; color: var(--gold); margin-bottom: 1rem;"></i>
                            <h4 class="mb-2">Have a News Tip?</h4>
                            <p class="mb-3">Share your story with our community of truth-seekers</p>
                            <button class="btn btn-viking btn-sm" style="width: 100%;">
                                <i class="fas fa-paper-plane"></i> Submit News
                            </button>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer style="background: var(--navy); color: var(--cream); padding: 3rem 0;">
        <div class="container">
            <div class="grid grid-3">
                <div>
                    <h4 style="color: var(--gold);">Much Love, No Fear</h4>
                    <p>A sanctuary for truth-seekers and free thinkers.</p>
                    <div class="flex gap-md" style="margin-top: 1rem;">
                        <a href="#" style="color: var(--cream); font-size: 1.5rem;"><i class="fab fa-twitter"></i></a>
                        <a href="#" style="color: var(--cream); font-size: 1.5rem;"><i class="fab fa-discord"></i></a>
                        <a href="#" style="color: var(--cream); font-size: 1.5rem;"><i class="fab fa-telegram"></i></a>
                    </div>
                </div>
                
                <div>
                    <h5 style="color: var(--gold);">Quick Links</h5>
                    <ul style="list-style: none;">
                        <li><a href="archive.html" style="color: var(--cream);">Love Vault</a></li>
                        <li><a href="blog.html" style="color: var(--cream);">Blog</a></li>
                        <li><a href="messageboard.html" style="color: var(--cream);">Message Board</a></li>
                        <li><a href="donations.html" style="color: var(--cream);">Support Us</a></li>
                    </ul>
                </div>
                
                <div>
                    <h5 style="color: var(--gold);">Community</h5>
                    <ul style="list-style: none;">
                        <li><a href="#" style="color: var(--cream);">Guidelines</a></li>
                        <li><a href="#" style="color: var(--cream);">Privacy Policy</a></li>
                        <li><a href="#" style="color: var(--cream);">Terms of Service</a></li>
                        <li><a href="#" style="color: var(--cream);">Contact</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="text-center" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <p>&copy; 2024 Much Love, No Fear. All rights reserved. Built with ‚ù§Ô∏è and Viking spirit.</p>
            </div>
        </div>
    </footer>

    <!-- Sidebar - Online Users -->
    <aside class="sidebar" id="sidebar">
        <button class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-chevron-right"></i>
        </button>
        
        <div class="runegold-display" id="runegoldDisplay">
            <div style="font-size: 0.875rem; margin-bottom: 0.25rem;">Your Runegold</div>
            <div class="runegold-amount" id="runegoldAmount">0</div>
            <a href="../dashboard.html" class="btn btn-sm btn-primary" style="margin-top: 0.5rem; width: 100%;">
                <i class="fas fa-shopping-cart"></i> Shop
            </a>
        </div>
        
        <h6 style="margin-bottom: 1rem;">
            <i class="fas fa-users"></i> Online Users
            <span id="onlineCount" style="font-size: 0.75rem; opacity: 0.7;">(0)</span>
        </h6>
        
        <ul class="online-users-list" id="onlineUsersList">
            <li class="text-center text-muted" style="padding: 2rem 0;">
                <i class="fas fa-user-slash" style="font-size: 2rem; opacity: 0.3;"></i>
                <p style="margin-top: 1rem; font-size: 0.875rem;">No users online</p>
            </li>
        </ul>
    </aside>

    <!-- Custom News Ticker Animation -->
    <style>
        @keyframes scroll-left {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
    </style>

    <!-- Submit News Modal -->
    <div class="modal" id="submitNewsModal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2><i class="fas fa-plus-circle"></i> Submit News Article</h2>
                <button class="btn-close" onclick="document.getElementById('submitNewsModal').style.display='none'">&times;</button>
            </div>
            <div class="modal-body">
                <form id="submitNewsForm">
                    <div class="viking-form-group">
                        <label class="viking-label" for="newsTitle">Article Title *</label>
                        <input type="text" id="newsTitle" class="viking-input" required maxlength="200" 
                               placeholder="Enter breaking news headline...">
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" for="newsExcerpt">Excerpt (Short Summary) *</label>
                        <textarea class="viking-textarea" id="newsExcerpt" class="viking-input" rows="2" required maxlength="300"
                                  placeholder="Write a brief summary that will appear in the news listing..."></textarea>
                        <small class="text-muted">Maximum 300 characters</small>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" for="newsCategory">Category *</label>
                        <select class="viking-select" id="newsCategory" class="viking-input" required>
                            <option value="">Select a category...</option>
                            <option value="Breaking">Breaking News</option>
                            <option value="Politics">Politics</option>
                            <option value="Health">Health</option>
                            <option value="Finance">Finance</option>
                            <option value="Technology">Technology</option>
                            <option value="World">World Events</option>
                        </select>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" for="newsSource">Source (Optional)</label>
                        <input type="text" id="newsSource" class="viking-input" 
                               placeholder="e.g., Independent Reporters Network, Citizen Journalist">
                        <small class="text-muted">Credit the original source if applicable</small>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" for="newsContent">Full Article *</label>
                        <textarea class="viking-textarea" id="newsContent" class="viking-input" rows="12" required
                                  placeholder="Write the full article here... (HTML supported: &lt;h2&gt;, &lt;p&gt;, &lt;ul&gt;, &lt;li&gt;, &lt;strong&gt;, &lt;em&gt;)"></textarea>
                        <small class="text-muted">You can use basic HTML formatting</small>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" class="checkbox-label">
                            <input type="checkbox" id="newsBreaking">
                            <span>Mark as Breaking News</span>
                        </label>
                    </div>
                    
                    <div class="flex gap-md">
                        <button type="submit" class="btn btn-viking btn-lg">
                            <i class="fas fa-paper-plane"></i> Submit News
                        </button>
                        <button type="button" class="btn btn-outline btn-lg" 
                                onclick="document.getElementById('submitNewsModal').style.display='none'">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="../auth-handler.js"></script>
    <script src="../api-client.js"></script>
    <script src="../mock-data.js"></script>
    <!-- Load scripts.js BEFORE page-loader.js so APIClient is defined -->
    <script src="../scripts.js"></script>
    <script src="../page-loader.js"></script>
    
    <!-- News Page Specific Script -->
    <script>
        // Submit News Button
        document.getElementById('submitNewsBtn').addEventListener('click', function() {
            // Check if user is logged in
            const token = localStorage.getItem('mlnf_token');
            if (!token) {
                alert('Please log in to submit news.');
                window.location.href = 'auth.html';
                return;
            }
            document.getElementById('submitNewsModal').style.display = 'flex';
        });
        
        // Submit News Form
        document.getElementById('submitNewsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
            
            try {
                const title = document.getElementById('newsTitle').value.trim();
                const excerpt = document.getElementById('newsExcerpt').value.trim();
                const content = document.getElementById('newsContent').value.trim();
                const category = document.getElementById('newsCategory').value;
                const source = document.getElementById('newsSource').value.trim() || 'Community Submission';
                const breaking = document.getElementById('newsBreaking').checked;
                
                // Create slug from title
                const slug = title.toLowerCase()
                    .replace(/[^a-z0-9]+/g, '-')
                    .replace(/(^-|-$)/g, '');
                
                const articleData = {
                    title,
                    slug,
                    excerpt,
                    content,
                    category,
                    source,
                    breaking,
                    trending: false
                };
                
                const response = await APIClient.news.create(articleData);
                
                // Show success message based on approval status
                const successMessage = response.requiresApproval
                    ? '‚úÖ News article submitted successfully!\n\nüìã Your submission is pending admin approval and will be published once reviewed.'
                    : '‚úÖ News article published successfully!';
                
                alert(successMessage);
                
                // Close modal and reset form
                document.getElementById('submitNewsModal').style.display = 'none';
                document.getElementById('submitNewsForm').reset();
                
                // Reload news articles (only admins will see their article immediately)
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.loadNews();
                }
                
            } catch (error) {
                console.error('Error submitting news:', error);
                let errorMsg = error.message || 'Please try again';
                
                // Add helpful hints based on error type
                if (errorMsg.includes('authenticate')) {
                    errorMsg += '\n\nPlease log out and log back in, your session may have expired.';
                } else if (errorMsg.includes('validation') || errorMsg.includes('invalid')) {
                    errorMsg += '\n\nPlease check all required fields are filled correctly.';
                }
                
                alert('‚ùå Failed to submit news:\n\n' + errorMsg);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });
    </script>
    <script src="../js/site-enhancements.js"></script>
</body>
</html>