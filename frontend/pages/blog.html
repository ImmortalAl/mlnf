<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Blog - Truth-seeking articles and insights on Much Love, No Fear">
    <title>Blog - Much Love, No Fear</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="container">
            <div class="flex flex-between">
                <div class="site-logo">
                    <i class="fas fa-shield-alt site-logo-icon"></i>
                    <span>Much Love, No Fear</span>
                </div>
                
                <nav class="site-nav" id="mainNav">
                    <a href="../index.html" class="nav-link">Home</a>
                    <a href="archive.html" class="nav-link">Love Vault</a>
                    <a href="blog.html" class="nav-link active">Blog</a>
                    <a href="news.html" class="nav-link">News</a>
                    <a href="messageboard.html" class="nav-link">Board</a>
                    <a href="donations.html" class="nav-link">Support</a>
                    <a href="merch.html" class="nav-link">Merch</a>
                    <a href="auth.html" class="nav-link" id="authLink">Login</a>
                    <a href="../dashboard.html" class="nav-link hidden" id="dashboardLink">Dashboard</a>
                    
                    <!-- Notification Bell -->
                    <div class="notification-bell hidden" id="notificationBell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge hidden" id="notificationBadge">0</span>
                    </div>
                    
                    <!-- Theme Toggle -->
                    <button class="btn-icon" id="themeToggle" title="Toggle theme">
                        <i class="fas fa-moon"></i>
                    </button>
                </nav>
                
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Page Hero -->
    <section class="page-hero" style="background: linear-gradient(135deg, var(--indigo) 0%, var(--navy) 100%); padding: 3rem 0; color: var(--cream);">
        <div class="container">
            <h1 style="color: var(--gold); text-shadow: 2px 2px 8px rgba(0,0,0,0.5);">
                <i class="fas fa-feather-alt"></i> Truth Blog
            </h1>
            <p style="font-size: 1.25rem; margin-top: 1rem;">
                Deep dives, insights, and articles from fearless writers
            </p>
        </div>
    </section>

    <!-- Blog Categories -->
    <section style="padding: 2rem 0; background: var(--gray-50);">
        <div class="container">
            <div class="flex gap-md flex-wrap">
                <button class="btn btn-outline active" data-category="all">All Posts</button>
                <button class="btn btn-outline" data-category="freedom">Freedom</button>
                <button class="btn btn-outline" data-category="health">Health</button>
                <button class="btn btn-outline" data-category="spirituality">Spirituality</button>
                <button class="btn btn-outline" data-category="politics">Politics</button>
                <button class="btn btn-outline" data-category="economy">Economy</button>
                <button class="btn btn-outline" data-category="technology">Technology</button>
                <button class="btn btn-secondary" id="writeBlogBtn">
                    <i class="fas fa-pen"></i> Write Article
                </button>
            </div>
        </div>
    </section>

    <!-- Featured Article -->
    <section style="padding: 3rem 0;">
        <div class="container">
            <div class="card card-viking" style="padding: 2rem;">
                <div class="flex gap-lg">
                    <div style="flex: 1;">
                        <div class="badge badge-gold" style="margin-bottom: 1rem;">Featured Article</div>
                        <h2 style="color: var(--navy); margin-bottom: 1rem;">The Awakening: Why Truth Matters More Than Ever</h2>
                        <div class="flex gap-md text-muted mb-2">
                            <span><i class="fas fa-user"></i> Sarah Truth-Seeker</span>
                            <span><i class="fas fa-calendar"></i> November 1, 2024</span>
                            <span><i class="fas fa-eye"></i> 15.2k views</span>
                        </div>
                        <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">
                            In an age of unprecedented censorship and information control, the need for platforms that protect free speech has never been more critical. This article explores the systematic suppression of dissenting voices and why we must stand together...
                        </p>
                        <a href="#" class="btn btn-viking">Read Full Article <i class="fas fa-arrow-right"></i></a>
                    </div>
                    <div style="width: 300px;">
                        <img src="../assets/images/placeholder-blog.jpg" alt="Featured Article" style="width: 100%; border-radius: var(--radius-lg);">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Blog Grid -->
    <section style="padding: 0 0 3rem 0;">
        <div class="container">
            <div class="grid grid-3" id="blogGrid">
                <!-- Blog posts will load here dynamically from API -->
            </div>

            <!-- Load More -->
            <div class="text-center" style="margin-top: 3rem;">
                <button class="btn btn-viking btn-lg">
                    <i class="fas fa-plus-circle"></i> Load More Articles
                </button>
            </div>
        </div>
    </section>

    <!-- Newsletter Subscribe -->
    <section style="background: linear-gradient(135deg, var(--peach), var(--indigo)); padding: 3rem 0; color: white;">
        <div class="container">
            <div class="text-center">
                <h2 style="color: white; margin-bottom: 1rem;">Stay Informed</h2>
                <p style="font-size: 1.25rem; margin-bottom: 2rem;">
                    Get uncensored news and insights delivered to your inbox
                </p>
                <form class="flex flex-center gap-md" style="max-width: 500px; margin: 0 auto;">
                    <input type="email" placeholder="Enter your email" class="form-control" style="flex: 1;">
                    <button type="submit" class="btn btn-viking">Subscribe</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer style="background: var(--navy); color: var(--cream); padding: 3rem 0;">
        <div class="container">
            <div class="grid grid-3">
                <div>
                    <h4 style="color: var(--gold);">Much Love, No Fear</h4>
                    <p>A sanctuary for truth-seekers and free thinkers.</p>
                    <div class="flex gap-md" style="margin-top: 1rem;">
                        <a href="#" style="color: var(--cream); font-size: 1.5rem;"><i class="fab fa-twitter"></i></a>
                        <a href="#" style="color: var(--cream); font-size: 1.5rem;"><i class="fab fa-discord"></i></a>
                        <a href="#" style="color: var(--cream); font-size: 1.5rem;"><i class="fab fa-telegram"></i></a>
                    </div>
                </div>
                
                <div>
                    <h5 style="color: var(--gold);">Quick Links</h5>
                    <ul style="list-style: none;">
                        <li><a href="archive.html" style="color: var(--cream);">Love Vault</a></li>
                        <li><a href="blog.html" style="color: var(--cream);">Blog</a></li>
                        <li><a href="messageboard.html" style="color: var(--cream);">Message Board</a></li>
                        <li><a href="donations.html" style="color: var(--cream);">Support Us</a></li>
                    </ul>
                </div>
                
                <div>
                    <h5 style="color: var(--gold);">Community</h5>
                    <ul style="list-style: none;">
                        <li><a href="#" style="color: var(--cream);">Guidelines</a></li>
                        <li><a href="#" style="color: var(--cream);">Privacy Policy</a></li>
                        <li><a href="#" style="color: var(--cream);">Terms of Service</a></li>
                        <li><a href="#" style="color: var(--cream);">Contact</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="text-center" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <p>&copy; 2024 Much Love, No Fear. All rights reserved. Built with ❤️ and Viking spirit.</p>
            </div>
        </div>
    </footer>

    <!-- Sidebar - Online Users -->
    <aside class="sidebar" id="sidebar">
        <button class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-chevron-right"></i>
        </button>
        
        <div class="runegold-display" id="runegoldDisplay">
            <div style="font-size: 0.875rem; margin-bottom: 0.25rem;">Your Runegold</div>
            <div class="runegold-amount" id="runegoldAmount">0</div>
            <a href="../dashboard.html" class="btn btn-sm btn-primary" style="margin-top: 0.5rem; width: 100%;">
                <i class="fas fa-shopping-cart"></i> Shop
            </a>
        </div>
        
        <h6 style="margin-bottom: 1rem;">
            <i class="fas fa-users"></i> Online Users
            <span id="onlineCount" style="font-size: 0.75rem; opacity: 0.7;">(0)</span>
        </h6>
        
        <ul class="online-users-list" id="onlineUsersList">
            <li class="text-center text-muted" style="padding: 2rem 0;">
                <i class="fas fa-user-slash" style="font-size: 2rem; opacity: 0.3;"></i>
                <p style="margin-top: 1rem; font-size: 0.875rem;">No users online</p>
            </li>
        </ul>
    </aside>

    <!-- Create Blog Post Modal -->
    <div class="modal" id="createBlogModal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2><i class="fas fa-pen"></i> Write New Blog Article</h2>
                <button class="btn-close" onclick="document.getElementById('createBlogModal').style.display='none'">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createBlogForm">
                    <div class="form-group">
                        <label for="blogTitle">Article Title *</label>
                        <input type="text" id="blogTitle" class="form-control" required maxlength="200" 
                               placeholder="Enter a compelling title...">
                    </div>
                    
                    <div class="form-group">
                        <label for="blogExcerpt">Excerpt (Short Summary) *</label>
                        <textarea id="blogExcerpt" class="form-control" rows="2" required maxlength="300"
                                  placeholder="Write a brief summary that will appear in the blog listing..."></textarea>
                        <small class="text-muted">Maximum 300 characters</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="blogCategory">Category *</label>
                        <select id="blogCategory" class="form-control" required>
                            <option value="">Select a category...</option>
                            <option value="Freedom">Freedom & Liberty</option>
                            <option value="Health">Health & Wellness</option>
                            <option value="Finance">Finance & Economy</option>
                            <option value="Technology">Technology</option>
                            <option value="Spirituality">Spirituality</option>
                            <option value="Education">Education</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="blogTags">Tags (comma-separated)</label>
                        <input type="text" id="blogTags" class="form-control" 
                               placeholder="awakening, truth, freedom, health">
                        <small class="text-muted">Add relevant tags separated by commas</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="blogContent">Article Content *</label>
                        <textarea id="blogContent" class="form-control" rows="12" required
                                  placeholder="Write your article here... (HTML supported: &lt;h2&gt;, &lt;p&gt;, &lt;ul&gt;, &lt;li&gt;, &lt;strong&gt;, &lt;em&gt;)"></textarea>
                        <small class="text-muted">You can use basic HTML formatting</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="blogFeatured">
                            <span>Feature this article (show prominently on blog page)</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="blogPublished" checked>
                            <span>Publish immediately</span>
                        </label>
                        <small class="text-muted">Uncheck to save as draft</small>
                    </div>
                    
                    <div class="flex gap-md">
                        <button type="submit" class="btn btn-viking btn-lg">
                            <i class="fas fa-paper-plane"></i> Publish Article
                        </button>
                        <button type="button" class="btn btn-outline btn-lg" 
                                onclick="document.getElementById('createBlogModal').style.display='none'">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="../auth-handler.js"></script>
    <script src="../api-client.js"></script>
    <script src="../mock-data.js"></script>
    <script src="../page-loader.js"></script>
    <script src="../scripts.js"></script>
    
    <!-- Blog Page Specific Script -->
    <script>
        // Write Article Button
        document.getElementById('writeBlogBtn').addEventListener('click', function() {
            // Check if user is logged in
            const token = localStorage.getItem('mlnf_token');
            if (!token) {
                alert('Please log in to write an article.');
                window.location.href = 'auth.html';
                return;
            }
            document.getElementById('createBlogModal').style.display = 'flex';
        });
        
        // Create Blog Form Submission
        document.getElementById('createBlogForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('🚀 Blog form submitted');
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publishing...';
            
            try {
                // Collect form data
                const title = document.getElementById('blogTitle').value.trim();
                const excerpt = document.getElementById('blogExcerpt').value.trim();
                const content = document.getElementById('blogContent').value.trim();
                const category = document.getElementById('blogCategory').value;
                const tagsInput = document.getElementById('blogTags').value.trim();
                const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];
                const featured = document.getElementById('blogFeatured').checked;
                const published = document.getElementById('blogPublished').checked;
                
                console.log('📝 Form data collected:', {
                    title,
                    excerpt: excerpt.substring(0, 50) + '...',
                    content: content.substring(0, 50) + '...',
                    category,
                    tagsCount: tags.length,
                    featured,
                    published
                });
                
                // Create slug from title
                const slug = title.toLowerCase()
                    .replace(/[^a-z0-9]+/g, '-')
                    .replace(/(^-|-$)/g, '');
                
                const postData = {
                    title,
                    slug,
                    excerpt,
                    content,
                    category,
                    tags,
                    featured,
                    published
                };
                
                console.log('📦 Post data prepared:', {
                    ...postData,
                    content: postData.content.substring(0, 50) + '...',
                    excerpt: postData.excerpt.substring(0, 50) + '...'
                });
                
                // Check authentication
                const token = localStorage.getItem('mlnf_token');
                console.log('🔐 Auth token present:', !!token);
                if (token) {
                    console.log('🔐 Token preview:', token.substring(0, 20) + '...');
                }
                
                // Make API call
                console.log('📡 Calling APIClient.blog.create...');
                const response = await APIClient.blog.create(postData);
                console.log('✅ API Response:', response);
                
                // Show success message
                alert('✅ Article published successfully!');
                
                // Close modal and reset form
                document.getElementById('createBlogModal').style.display = 'none';
                document.getElementById('createBlogForm').reset();
                
                // Reload blog posts
                if (typeof PageLoader !== 'undefined') {
                    console.log('🔄 Reloading blog posts...');
                    PageLoader.loadBlog();
                }
                
            } catch (error) {
                console.error('❌ Error creating blog post:', error);
                console.error('❌ Error details:', {
                    message: error.message,
                    stack: error.stack,
                    name: error.name
                });
                
                let errorMsg = error.message || 'Please try again';
                
                // Add helpful hints based on error type
                if (errorMsg.includes('authenticate')) {
                    errorMsg += '\n\nPlease log out and log back in, your session may have expired.';
                } else if (errorMsg.includes('validation') || errorMsg.includes('invalid')) {
                    errorMsg += '\n\nPlease check all required fields are filled correctly.';
                }
                
                alert('❌ Failed to publish article:\n\n' + errorMsg);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                console.log('🏁 Form submission complete');
            }
        });
    </script>
</body>
</html>