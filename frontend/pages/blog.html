<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="Blog - Truth-seeking articles and insights on Much Love, No Fear">
    <title>Blog - Much Love, No Fear</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../css/viking-components.css">
    <link rel="stylesheet" href="../css/mobile-optimized.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Blog Post Card Styles */
        .blog-post-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .blog-post-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: var(--gold);
        }

        .blog-card-image-container {
            position: relative;
            height: 200px;
            overflow: hidden;
        }

        .blog-card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .blog-post-card:hover .blog-card-image {
            transform: scale(1.08);
        }

        .blog-card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60%;
            background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 100%);
            pointer-events: none;
        }

        .blog-card-badges {
            position: absolute;
            top: 12px;
            left: 12px;
            right: 12px;
            display: flex;
            justify-content: space-between;
            z-index: 2;
        }

        .blog-card-category {
            padding: 6px 12px;
            background: linear-gradient(135deg, var(--indigo), var(--navy));
            color: white;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .blog-card-featured {
            padding: 6px 12px;
            background: linear-gradient(135deg, var(--gold), #e6a800);
            color: var(--navy);
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .blog-card-body {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .blog-card-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--navy);
            margin-bottom: 0.75rem;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .blog-card-excerpt {
            color: var(--gray-600);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 1rem;
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .blog-card-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-200);
            flex-wrap: wrap;
        }

        .blog-card-author {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .blog-card-author-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--indigo), var(--peach));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .blog-card-author-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--navy);
        }

        .blog-card-stats {
            display: flex;
            gap: 1rem;
            margin-left: auto;
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        .blog-card-stat {
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .blog-card-stat i {
            font-size: 0.75rem;
        }

        .blog-card-footer {
            padding: 0.75rem 1.5rem;
            background: var(--gray-50);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .blog-card-date {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        .blog-card-read-more {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--indigo);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: gap 0.3s ease;
        }

        .blog-post-card:hover .blog-card-read-more {
            gap: 0.75rem;
            color: var(--gold);
        }

        /* Empty state styling */
        .blog-empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 4rem 2rem;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .blog-empty-state i {
            font-size: 4rem;
            color: var(--gray-300);
            margin-bottom: 1.5rem;
        }

        .blog-empty-state h3 {
            color: var(--navy);
            margin-bottom: 0.5rem;
        }

        @media (max-width: 768px) {
            .blog-card-image-container {
                height: 160px;
            }

            .blog-card-body {
                padding: 1.25rem;
            }

            .blog-card-title {
                font-size: 1rem;
            }

            .blog-card-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }

            .blog-card-stats {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Fixed Header Spacer -->
    <div class="header-spacer"></div>

    <!-- Header -->
    <header class="site-header">
        <div class="container">
            <div class="flex flex-between">
                <div class="site-logo">
                    <i class="fas fa-shield-alt site-logo-icon"></i>
                    <span>Much Love, No Fear</span>
                </div>
                
                <nav class="site-nav" id="mainNav">
                    <a href="../index.html" class="nav-link">Home</a>
                    <a href="live.html" class="nav-link">Live</a>
                    <a href="archive.html" class="nav-link">The Vault</a>
                    <a href="blog.html" class="nav-link active">Blog</a>
                    <a href="news.html" class="nav-link">News</a>
                    <a href="messageboard.html" class="nav-link">Board</a>
                    <a href="donations.html" class="nav-link">Support</a>
                    <a href="merch.html" class="nav-link">Merch</a>
                    <a href="auth.html" class="nav-link" id="authLink">Login</a>
                    <a href="../dashboard.html" class="nav-link hidden" id="dashboardLink">Dashboard</a>
                    
                    <!-- Notification Bell -->
                    <div class="notification-bell hidden" id="notificationBell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge hidden" id="notificationBadge">0</span>
                    </div>
                    
                    <!-- Theme Toggle -->
                    <button class="btn-icon" id="themeToggle" title="Toggle theme">
                        <i class="fas fa-moon"></i>
                    </button>
                </nav>
                
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Page Hero -->
    <section class="page-hero" style="background: linear-gradient(135deg, var(--indigo) 0%, var(--navy) 100%); padding: 3rem 0; color: var(--cream);">
        <div class="container">
            <h1 style="color: var(--gold); text-shadow: 2px 2px 8px rgba(0,0,0,0.5);">
                <i class="fas fa-feather-alt"></i> Truth Blog
            </h1>
            <p style="font-size: 1.25rem; margin-top: 1rem;">
                Deep dives, insights, and articles from fearless writers
            </p>
        </div>
    </section>

    <!-- Blog Categories -->
    <section style="padding: 2rem 0; background: var(--gray-50);">
        <div class="container">
            <div class="flex gap-md flex-wrap">
                <button class="btn btn-outline active" data-category="all">All Posts</button>
                <button class="btn-viking-secondary" data-category="freedom">Freedom</button>
                <button class="btn-viking-secondary" data-category="health">Health</button>
                <button class="btn-viking-secondary" data-category="spirituality">Spirituality</button>
                <button class="btn-viking-secondary" data-category="politics">Politics</button>
                <button class="btn-viking-secondary" data-category="economy">Economy</button>
                <button class="btn-viking-secondary" data-category="technology">Technology</button>
                <button class="btn-viking-secondary" id="writeBlogBtn">
                    <i class="fas fa-pen"></i> Write Article
                </button>
            </div>
        </div>
    </section>

    <!-- Featured Article (dynamically loaded) -->
    <section id="featuredArticleSection" style="padding: 3rem 0; display: none;">
        <div class="container">
            <div class="card card-viking" style="padding: 2rem;" id="featuredArticleCard">
                <!-- Featured article will be loaded here dynamically -->
            </div>
        </div>
    </section>

    <!-- Blog Grid -->
    <section style="padding: 0 0 3rem 0;">
        <div class="container">
            <div class="grid grid-3" id="blogGrid">
                <!-- Blog posts will load here dynamically from API -->
            </div>

            <!-- Load More -->
            <div class="text-center" style="margin-top: 3rem;">
                <button class="btn btn-viking btn-lg">
                    <i class="fas fa-plus-circle"></i> Load More Articles
                </button>
            </div>
        </div>
    </section>

    <!-- Newsletter Subscribe -->
    <section style="background: linear-gradient(135deg, var(--peach), var(--indigo)); padding: 3rem 0; color: white;">
        <div class="container">
            <div class="text-center">
                <h2 style="color: white; margin-bottom: 1rem;">Stay Informed</h2>
                <p style="font-size: 1.25rem; margin-bottom: 2rem;">
                    Get uncensored news and insights delivered to your inbox
                </p>
                <form class="flex flex-center gap-md" style="max-width: 500px; margin: 0 auto;">
                    <input type="email" placeholder="Enter your email" class="viking-input" style="flex: 1;">
                    <button type="submit" class="btn-viking-primary">Subscribe</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer style="background: var(--navy); color: var(--cream); padding: 3rem 0;">
        <div class="container">
            <div class="grid grid-3">
                <div>
                    <h4 style="color: var(--gold);">Much Love, No Fear</h4>
                    <p>A sanctuary for truth-seekers and free thinkers.</p>
                    <div class="flex gap-md" style="margin-top: 1rem;">
                        <a href="#" style="color: var(--cream); font-size: 1.5rem;"><i class="fab fa-twitter"></i></a>
                        <a href="#" style="color: var(--cream); font-size: 1.5rem;"><i class="fab fa-discord"></i></a>
                        <a href="#" style="color: var(--cream); font-size: 1.5rem;"><i class="fab fa-telegram"></i></a>
                    </div>
                </div>
                
                <div>
                    <h5 style="color: var(--gold);">Quick Links</h5>
                    <ul style="list-style: none;">
                        <li><a href="archive.html" style="color: var(--cream);">The Vault</a></li>
                        <li><a href="blog.html" style="color: var(--cream);">Blog</a></li>
                        <li><a href="messageboard.html" style="color: var(--cream);">Message Board</a></li>
                        <li><a href="donations.html" style="color: var(--cream);">Support Us</a></li>
                    </ul>
                </div>
                
                <div>
                    <h5 style="color: var(--gold);">Community</h5>
                    <ul style="list-style: none;">
                        <li><a href="#" style="color: var(--cream);">Guidelines</a></li>
                        <li><a href="#" style="color: var(--cream);">Privacy Policy</a></li>
                        <li><a href="#" style="color: var(--cream);">Terms of Service</a></li>
                        <li><a href="#" style="color: var(--cream);">Contact</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="text-center" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <p>&copy; 2024 Much Love, No Fear. All rights reserved. Built with ‚ù§Ô∏è and Viking spirit.</p>
            </div>
        </div>
    </footer>

    <!-- Sidebar Toggle Button (outside sidebar for proper fixed positioning) -->
    <button class="sidebar-toggle" id="sidebarToggle">
        <i class="fas fa-chevron-left"></i>
    </button>

    <!-- Sidebar - Online Users -->
    <aside class="sidebar" id="sidebar">
        <div class="runegold-display" id="runegoldDisplay">
            <div style="font-size: 0.875rem; margin-bottom: 0.25rem;">Your Runegold</div>
            <div class="runegold-amount" id="runegoldAmount">0</div>
            <a href="../dashboard.html" class="btn btn-sm btn-primary" style="margin-top: 0.5rem; width: 100%;">
                <i class="fas fa-shopping-cart"></i> Shop
            </a>
        </div>
        
        <h6 style="margin-bottom: 1rem;">
            <i class="fas fa-users"></i> Online Users
            <span id="onlineCount" style="font-size: 0.75rem; opacity: 0.7;">(0)</span>
        </h6>
        
        <ul class="online-users-list" id="onlineUsersList">
            <li class="text-center text-muted" style="padding: 2rem 0;">
                <i class="fas fa-user-slash" style="font-size: 2rem; opacity: 0.3;"></i>
                <p style="margin-top: 1rem; font-size: 0.875rem;">No users online</p>
            </li>
        </ul>
    </aside>

    <!-- Create Blog Post Modal -->
    <div class="modal" id="createBlogModal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2><i class="fas fa-pen"></i> Write New Blog Article</h2>
                <button class="btn-close" onclick="document.getElementById('createBlogModal').style.display='none'">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createBlogForm">
                    <div class="viking-form-group">
                        <label class="viking-label" for="blogTitle">Article Title *</label>
                        <input type="text" id="blogTitle" class="viking-input" required maxlength="200" 
                               placeholder="Enter a compelling title...">
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" for="blogExcerpt">Excerpt (Short Summary) *</label>
                        <textarea class="viking-textarea" id="blogExcerpt" class="viking-input" rows="2" required maxlength="300"
                                  placeholder="Write a brief summary that will appear in the blog listing..."></textarea>
                        <small class="text-muted">Maximum 300 characters</small>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" for="blogCategory">Category *</label>
                        <select class="viking-select" id="blogCategory" class="viking-input" required>
                            <option value="">Select a category...</option>
                            <option value="Freedom">Freedom & Liberty</option>
                            <option value="Health">Health & Wellness</option>
                            <option value="Finance">Finance & Economy</option>
                            <option value="Technology">Technology</option>
                            <option value="Spirituality">Spirituality</option>
                            <option value="Education">Education</option>
                        </select>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" for="blogTags">Tags (comma-separated)</label>
                        <input type="text" id="blogTags" class="viking-input" 
                               placeholder="awakening, truth, freedom, health">
                        <small class="text-muted">Add relevant tags separated by commas</small>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" for="blogContent">Article Content *</label>
                        <textarea class="viking-textarea" id="blogContent" class="viking-input" rows="12" required
                                  placeholder="Write your article here... (HTML supported: &lt;h2&gt;, &lt;p&gt;, &lt;ul&gt;, &lt;li&gt;, &lt;strong&gt;, &lt;em&gt;)"></textarea>
                        <small class="text-muted">You can use basic HTML formatting</small>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" class="checkbox-label">
                            <input type="checkbox" id="blogFeatured">
                            <span>Feature this article (show prominently on blog page)</span>
                        </label>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" class="checkbox-label">
                            <input type="checkbox" id="blogPublished" checked>
                            <span>Publish immediately</span>
                        </label>
                        <small class="text-muted">Uncheck to save as draft</small>
                    </div>
                    
                    <div class="flex gap-md">
                        <button type="submit" class="btn btn-viking btn-lg">
                            <i class="fas fa-paper-plane"></i> Publish Article
                        </button>
                        <button type="button" class="btn btn-outline btn-lg" 
                                onclick="document.getElementById('createBlogModal').style.display='none'">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="../auth-handler.js"></script>
    <script src="../api-client.js"></script>
    <script src="../mock-data.js"></script>
    <!-- Load scripts.js BEFORE page-loader.js so APIClient is defined -->
    <script src="../scripts.js"></script>
    <script src="../page-loader.js"></script>
    
    <!-- Blog Page Specific Script -->
    <script>
        // Write Article Button
        document.getElementById('writeBlogBtn').addEventListener('click', function() {
            // Check if user is logged in
            const token = localStorage.getItem('mlnf_token');
            if (!token) {
                alert('Please log in to write an article.');
                window.location.href = 'auth.html';
                return;
            }
            document.getElementById('createBlogModal').style.display = 'flex';
        });
        
        // Create Blog Form Submission
        document.getElementById('createBlogForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('üöÄ Blog form submitted');
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publishing...';
            
            try {
                // Collect form data
                const title = document.getElementById('blogTitle').value.trim();
                const excerpt = document.getElementById('blogExcerpt').value.trim();
                const content = document.getElementById('blogContent').value.trim();
                const category = document.getElementById('blogCategory').value;
                const tagsInput = document.getElementById('blogTags').value.trim();
                const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];
                const featured = document.getElementById('blogFeatured').checked;
                const published = document.getElementById('blogPublished').checked;
                
                console.log('üìù Form data collected:', {
                    title,
                    excerpt: excerpt.substring(0, 50) + '...',
                    content: content.substring(0, 50) + '...',
                    category,
                    tagsCount: tags.length,
                    featured,
                    published
                });
                
                // Create slug from title
                const slug = title.toLowerCase()
                    .replace(/[^a-z0-9]+/g, '-')
                    .replace(/(^-|-$)/g, '');
                
                const postData = {
                    title,
                    slug,
                    excerpt,
                    content,
                    category,
                    tags,
                    featured,
                    published
                };
                
                console.log('üì¶ Post data prepared:', {
                    ...postData,
                    content: postData.content.substring(0, 50) + '...',
                    excerpt: postData.excerpt.substring(0, 50) + '...'
                });
                
                // Check authentication
                const token = localStorage.getItem('mlnf_token');
                console.log('üîê Auth token present:', !!token);
                if (token) {
                    console.log('üîê Token preview:', token.substring(0, 20) + '...');
                }
                
                // Make API call
                console.log('üì° Calling APIClient.blog.create...');
                const response = await APIClient.blog.create(postData);
                console.log('‚úÖ API Response:', response);
                
                // Show success message
                alert('‚úÖ Article published successfully!');
                
                // Close modal and reset form
                document.getElementById('createBlogModal').style.display = 'none';
                document.getElementById('createBlogForm').reset();
                
                // Reload blog posts
                if (typeof PageLoader !== 'undefined') {
                    console.log('üîÑ Reloading blog posts...');
                    PageLoader.loadBlog();
                }
                
            } catch (error) {
                console.error('‚ùå Error creating blog post:', error);
                console.error('‚ùå Error details:', {
                    message: error.message,
                    stack: error.stack,
                    name: error.name
                });
                
                let errorMsg = error.message || 'Please try again';
                
                // Add helpful hints based on error type
                if (errorMsg.includes('authenticate') || errorMsg.includes('logged in')) {
                    alert('‚ùå Authentication Error\n\nYou need to log in first to publish articles.\n\nClick OK to go to the login page.');
                    window.location.href = 'auth.html';
                    return;
                } else if (errorMsg.includes('validation') || errorMsg.includes('invalid')) {
                    errorMsg += '\n\nPlease check all required fields are filled correctly.';
                    alert('‚ùå Failed to publish article:\n\n' + errorMsg);
                } else {
                    alert('‚ùå Failed to publish article:\n\n' + errorMsg);
                }
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                console.log('üèÅ Form submission complete');
            }
        });
    </script>

    <!-- Blog Posts Loading Script -->
    <script>
        // Load blog posts from API
        async function loadBlogPosts(category = 'all', page = 1) {
            const blogGrid = document.getElementById('blogGrid');

            // Show loading state
            blogGrid.innerHTML = `
                <div class="skeleton-card card">
                    <div class="skeleton" style="height: 200px;"></div>
                    <div class="card-body">
                        <div class="skeleton skeleton-text" style="width: 80%;"></div>
                        <div class="skeleton skeleton-text" style="width: 60%;"></div>
                    </div>
                </div>
                <div class="skeleton-card card">
                    <div class="skeleton" style="height: 200px;"></div>
                    <div class="card-body">
                        <div class="skeleton skeleton-text" style="width: 70%;"></div>
                        <div class="skeleton skeleton-text" style="width: 50%;"></div>
                    </div>
                </div>
                <div class="skeleton-card card">
                    <div class="skeleton" style="height: 200px;"></div>
                    <div class="card-body">
                        <div class="skeleton skeleton-text" style="width: 90%;"></div>
                        <div class="skeleton skeleton-text" style="width: 40%;"></div>
                    </div>
                </div>
            `;

            try {
                const url = category === 'all'
                    ? `/api/blog?page=${page}&limit=9`
                    : `/api/blog?category=${category}&page=${page}&limit=9`;

                const response = await fetch(url);

                if (response.ok) {
                    const data = await response.json();
                    renderBlogPosts(data.posts || []);

                    // Check for featured article
                    const featured = (data.posts || []).find(p => p.featured);
                    if (featured) {
                        renderFeaturedArticle(featured);
                    }
                } else {
                    // Show empty state if API not available
                    renderSamplePosts();
                }
            } catch (error) {
                console.log('Blog API not available, showing empty state');
                renderSamplePosts();
            }
        }

        function renderFeaturedArticle(post) {
            const section = document.getElementById('featuredArticleSection');
            const card = document.getElementById('featuredArticleCard');

            if (!post) {
                section.style.display = 'none';
                return;
            }

            const authorName = post.author?.username || 'Anonymous';
            const imageUrl = post.featuredImage || post.image || `https://picsum.photos/seed/${post._id}/400/250`;

            card.innerHTML = `
                <div class="flex gap-lg" style="flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 300px;">
                        <div class="badge badge-gold" style="margin-bottom: 1rem;">
                            <i class="fas fa-star"></i> Featured Article
                        </div>
                        <h2 style="color: var(--navy); margin-bottom: 1rem;">${post.title}</h2>
                        <div class="flex gap-md text-muted mb-2" style="flex-wrap: wrap;">
                            <span><i class="fas fa-user"></i> ${authorName}</span>
                            <span><i class="fas fa-calendar"></i> ${formatDate(post.createdAt)}</span>
                            <span><i class="fas fa-eye"></i> ${formatNumber(post.views || 0)} views</span>
                        </div>
                        <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">
                            ${post.excerpt || (post.content ? post.content.substring(0, 250) + '...' : 'Click to read this featured article.')}
                        </p>
                        <a href="blog-post.html?id=${post._id}" class="btn-viking-primary">
                            Read Full Article <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                    <div style="width: 300px; flex-shrink: 0;">
                        <img src="${imageUrl}"
                             alt="${post.title}"
                             style="width: 100%; border-radius: var(--radius-lg); object-fit: cover; aspect-ratio: 4/3;"
                             onerror="this.style.display='none'">
                    </div>
                </div>
            `;

            section.style.display = 'block';
        }

        function renderBlogPosts(posts) {
            const blogGrid = document.getElementById('blogGrid');

            if (posts.length === 0) {
                blogGrid.innerHTML = `
                    <div class="blog-empty-state">
                        <i class="fas fa-feather-alt"></i>
                        <h3>No Articles Yet</h3>
                        <p class="text-muted">Be the first to share your wisdom!</p>
                        <button class="btn btn-viking mt-2" onclick="document.getElementById('writeBlogBtn').click()">
                            <i class="fas fa-pen"></i> Write the First Article
                        </button>
                    </div>
                `;
                return;
            }

            const authorName = (post) => post.author?.username || 'Anonymous';
            const authorInitial = (post) => (post.author?.username || 'A').charAt(0).toUpperCase();

            blogGrid.innerHTML = posts.map(post => `
                <article class="blog-post-card" onclick="viewBlogPost('${post._id || post.slug}')">
                    <div class="blog-card-image-container">
                        <img class="blog-card-image"
                             src="${post.featuredImage || post.image || `https://picsum.photos/seed/${post._id || post.slug}/400/200`}"
                             alt="${post.title}"
                             onerror="this.src='https://via.placeholder.com/400x200/4A5568/FFFFFF?text=Blog'">
                        <div class="blog-card-overlay"></div>
                        <div class="blog-card-badges">
                            <span class="blog-card-category">${post.category || 'General'}</span>
                            ${post.featured ? '<span class="blog-card-featured"><i class="fas fa-star"></i> Featured</span>' : ''}
                        </div>
                    </div>
                    <div class="blog-card-body">
                        <h3 class="blog-card-title">${post.title}</h3>
                        <p class="blog-card-excerpt">${post.excerpt || (post.content ? post.content.substring(0, 150) + '...' : 'No description available.')}</p>
                        <div class="blog-card-meta">
                            <div class="blog-card-author">
                                <div class="blog-card-author-avatar">${authorInitial(post)}</div>
                                <span class="blog-card-author-name">${authorName(post)}</span>
                            </div>
                            <div class="blog-card-stats">
                                <span class="blog-card-stat" title="Views">
                                    <i class="fas fa-eye"></i> ${formatNumber(post.views || 0)}
                                </span>
                                <span class="blog-card-stat" title="Likes">
                                    <i class="fas fa-heart"></i> ${post.likes?.length || post.likes || 0}
                                </span>
                                <span class="blog-card-stat" title="Comments">
                                    <i class="fas fa-comment"></i> ${post.comments?.length || 0}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="blog-card-footer">
                        <span class="blog-card-date">
                            <i class="fas fa-calendar-alt"></i> ${formatDate(post.createdAt)}
                        </span>
                        <span class="blog-card-read-more">
                            Read More <i class="fas fa-arrow-right"></i>
                        </span>
                    </div>
                </article>
            `).join('');
        }

        function renderSamplePosts() {
            // Show empty state instead of fake placeholder posts
            renderBlogPosts([]);
        }

        function viewBlogPost(postId) {
            // Navigate to blog post detail page
            window.location.href = `blog-post.html?id=${postId}`;
        }

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'k';
            return num.toString();
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'Recently';
            const date = new Date(dateStr);
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
            return date.toLocaleDateString();
        }

        // Category filter buttons
        document.querySelectorAll('[data-category]').forEach(btn => {
            btn.addEventListener('click', function() {
                // Update active state
                document.querySelectorAll('[data-category]').forEach(b => {
                    b.classList.remove('active', 'btn-viking');
                    b.classList.add('btn-outline');
                });
                this.classList.add('active');
                this.classList.remove('btn-outline');

                // Load posts for category
                loadBlogPosts(this.dataset.category);
            });
        });

        // Initialize blog posts on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadBlogPosts();
        });
    </script>
    <script src="../js/site-enhancements.js"></script>
    <script src="js/mobile-viewport-handler.js"></script>
</body>
</html>