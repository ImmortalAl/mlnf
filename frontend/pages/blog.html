<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="Blog - Truth-seeking articles and insights on Much Love, No Fear">
    <title>Blog - Much Love, No Fear</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../css/viking-components.css">
    <link rel="stylesheet" href="../css/mobile-optimized.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Fixed Header Spacer -->
    <div class="header-spacer"></div>

    <!-- Header -->
    <header class="site-header">
        <div class="container">
            <div class="flex flex-between">
                <div class="site-logo">
                    <i class="fas fa-shield-alt site-logo-icon"></i>
                    <span>Much Love, No Fear</span>
                </div>
                
                <nav class="site-nav" id="mainNav">
                    <a href="../index.html" class="nav-link">Home</a>
                    <a href="live.html" class="nav-link">Live</a>
                    <a href="archive.html" class="nav-link">The Vault</a>
                    <a href="blog.html" class="nav-link active">Blog</a>
                    <a href="news.html" class="nav-link">News</a>
                    <a href="messageboard.html" class="nav-link">Board</a>
                    <a href="donations.html" class="nav-link">Support</a>
                    <a href="merch.html" class="nav-link">Merch</a>
                    <a href="auth.html" class="nav-link" id="authLink">Login</a>
                    <a href="../dashboard.html" class="nav-link hidden" id="dashboardLink">Dashboard</a>
                    
                    <!-- Notification Bell -->
                    <div class="notification-bell hidden" id="notificationBell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge hidden" id="notificationBadge">0</span>
                    </div>
                    
                    <!-- Theme Toggle -->
                    <button class="btn-icon" id="themeToggle" title="Toggle theme">
                        <i class="fas fa-moon"></i>
                    </button>
                </nav>
                
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Page Hero -->
    <section class="page-hero" style="background: linear-gradient(135deg, var(--indigo) 0%, var(--navy) 100%); padding: 3rem 0; color: var(--cream);">
        <div class="container">
            <h1 style="color: var(--gold); text-shadow: 2px 2px 8px rgba(0,0,0,0.5);">
                <i class="fas fa-feather-alt"></i> Truth Blog
            </h1>
            <p style="font-size: 1.25rem; margin-top: 1rem;">
                Deep dives, insights, and articles from fearless writers
            </p>
        </div>
    </section>

    <!-- Blog Categories -->
    <section style="padding: 2rem 0; background: var(--gray-50);">
        <div class="container">
            <div class="flex gap-md flex-wrap">
                <button class="btn btn-outline active" data-category="all">All Posts</button>
                <button class="btn-viking-secondary" data-category="freedom">Freedom</button>
                <button class="btn-viking-secondary" data-category="health">Health</button>
                <button class="btn-viking-secondary" data-category="spirituality">Spirituality</button>
                <button class="btn-viking-secondary" data-category="politics">Politics</button>
                <button class="btn-viking-secondary" data-category="economy">Economy</button>
                <button class="btn-viking-secondary" data-category="technology">Technology</button>
                <button class="btn-viking-secondary" id="writeBlogBtn">
                    <i class="fas fa-pen"></i> Write Article
                </button>
            </div>
        </div>
    </section>

    <!-- Featured Article -->
    <section style="padding: 3rem 0;">
        <div class="container">
            <div class="card card-viking" style="padding: 2rem;">
                <div class="flex gap-lg">
                    <div style="flex: 1;">
                        <div class="badge badge-gold" style="margin-bottom: 1rem;">Featured Article</div>
                        <h2 style="color: var(--navy); margin-bottom: 1rem;">The Awakening: Why Truth Matters More Than Ever</h2>
                        <div class="flex gap-md text-muted mb-2">
                            <span><i class="fas fa-user"></i> Sarah Truth-Seeker</span>
                            <span><i class="fas fa-calendar"></i> November 1, 2024</span>
                            <span><i class="fas fa-eye"></i> 15.2k views</span>
                        </div>
                        <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">
                            In an age of unprecedented censorship and information control, the need for platforms that protect free speech has never been more critical. This article explores the systematic suppression of dissenting voices and why we must stand together...
                        </p>
                        <a href="#" class="btn-viking-primary">Read Full Article <i class="fas fa-arrow-right"></i></a>
                    </div>
                    <div style="width: 300px;">
                        <img src="https://via.placeholder.com/300x200/4A90E2/FFFFFF?text=Featured+Article" alt="Featured Article" style="width: 100%; border-radius: var(--radius-lg);" onerror="this.style.display='none'">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Blog Grid -->
    <section style="padding: 0 0 3rem 0;">
        <div class="container">
            <div class="grid grid-3" id="blogGrid">
                <!-- Blog posts will load here dynamically from API -->
            </div>

            <!-- Load More -->
            <div class="text-center" style="margin-top: 3rem;">
                <button class="btn btn-viking btn-lg">
                    <i class="fas fa-plus-circle"></i> Load More Articles
                </button>
            </div>
        </div>
    </section>

    <!-- Newsletter Subscribe -->
    <section style="background: linear-gradient(135deg, var(--peach), var(--indigo)); padding: 3rem 0; color: white;">
        <div class="container">
            <div class="text-center">
                <h2 style="color: white; margin-bottom: 1rem;">Stay Informed</h2>
                <p style="font-size: 1.25rem; margin-bottom: 2rem;">
                    Get uncensored news and insights delivered to your inbox
                </p>
                <form class="flex flex-center gap-md" style="max-width: 500px; margin: 0 auto;">
                    <input type="email" placeholder="Enter your email" class="viking-input" style="flex: 1;">
                    <button type="submit" class="btn-viking-primary">Subscribe</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer style="background: var(--navy); color: var(--cream); padding: 3rem 0;">
        <div class="container">
            <div class="grid grid-3">
                <div>
                    <h4 style="color: var(--gold);">Much Love, No Fear</h4>
                    <p>A sanctuary for truth-seekers and free thinkers.</p>
                    <div class="flex gap-md" style="margin-top: 1rem;">
                        <a href="#" style="color: var(--cream); font-size: 1.5rem;"><i class="fab fa-twitter"></i></a>
                        <a href="#" style="color: var(--cream); font-size: 1.5rem;"><i class="fab fa-discord"></i></a>
                        <a href="#" style="color: var(--cream); font-size: 1.5rem;"><i class="fab fa-telegram"></i></a>
                    </div>
                </div>
                
                <div>
                    <h5 style="color: var(--gold);">Quick Links</h5>
                    <ul style="list-style: none;">
                        <li><a href="archive.html" style="color: var(--cream);">The Vault</a></li>
                        <li><a href="blog.html" style="color: var(--cream);">Blog</a></li>
                        <li><a href="messageboard.html" style="color: var(--cream);">Message Board</a></li>
                        <li><a href="donations.html" style="color: var(--cream);">Support Us</a></li>
                    </ul>
                </div>
                
                <div>
                    <h5 style="color: var(--gold);">Community</h5>
                    <ul style="list-style: none;">
                        <li><a href="#" style="color: var(--cream);">Guidelines</a></li>
                        <li><a href="#" style="color: var(--cream);">Privacy Policy</a></li>
                        <li><a href="#" style="color: var(--cream);">Terms of Service</a></li>
                        <li><a href="#" style="color: var(--cream);">Contact</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="text-center" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <p>&copy; 2024 Much Love, No Fear. All rights reserved. Built with ‚ù§Ô∏è and Viking spirit.</p>
            </div>
        </div>
    </footer>

    <!-- Sidebar - Online Users -->
    <aside class="sidebar" id="sidebar">
        <button class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-chevron-right"></i>
        </button>
        
        <div class="runegold-display" id="runegoldDisplay">
            <div style="font-size: 0.875rem; margin-bottom: 0.25rem;">Your Runegold</div>
            <div class="runegold-amount" id="runegoldAmount">0</div>
            <a href="../dashboard.html" class="btn btn-sm btn-primary" style="margin-top: 0.5rem; width: 100%;">
                <i class="fas fa-shopping-cart"></i> Shop
            </a>
        </div>
        
        <h6 style="margin-bottom: 1rem;">
            <i class="fas fa-users"></i> Online Users
            <span id="onlineCount" style="font-size: 0.75rem; opacity: 0.7;">(0)</span>
        </h6>
        
        <ul class="online-users-list" id="onlineUsersList">
            <li class="text-center text-muted" style="padding: 2rem 0;">
                <i class="fas fa-user-slash" style="font-size: 2rem; opacity: 0.3;"></i>
                <p style="margin-top: 1rem; font-size: 0.875rem;">No users online</p>
            </li>
        </ul>
    </aside>

    <!-- Create Blog Post Modal -->
    <div class="modal" id="createBlogModal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2><i class="fas fa-pen"></i> Write New Blog Article</h2>
                <button class="btn-close" onclick="document.getElementById('createBlogModal').style.display='none'">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createBlogForm">
                    <div class="viking-form-group">
                        <label class="viking-label" for="blogTitle">Article Title *</label>
                        <input type="text" id="blogTitle" class="viking-input" required maxlength="200" 
                               placeholder="Enter a compelling title...">
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" for="blogExcerpt">Excerpt (Short Summary) *</label>
                        <textarea class="viking-textarea" id="blogExcerpt" class="viking-input" rows="2" required maxlength="300"
                                  placeholder="Write a brief summary that will appear in the blog listing..."></textarea>
                        <small class="text-muted">Maximum 300 characters</small>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" for="blogCategory">Category *</label>
                        <select class="viking-select" id="blogCategory" class="viking-input" required>
                            <option value="">Select a category...</option>
                            <option value="Freedom">Freedom & Liberty</option>
                            <option value="Health">Health & Wellness</option>
                            <option value="Finance">Finance & Economy</option>
                            <option value="Technology">Technology</option>
                            <option value="Spirituality">Spirituality</option>
                            <option value="Education">Education</option>
                        </select>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" for="blogTags">Tags (comma-separated)</label>
                        <input type="text" id="blogTags" class="viking-input" 
                               placeholder="awakening, truth, freedom, health">
                        <small class="text-muted">Add relevant tags separated by commas</small>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" for="blogContent">Article Content *</label>
                        <textarea class="viking-textarea" id="blogContent" class="viking-input" rows="12" required
                                  placeholder="Write your article here... (HTML supported: &lt;h2&gt;, &lt;p&gt;, &lt;ul&gt;, &lt;li&gt;, &lt;strong&gt;, &lt;em&gt;)"></textarea>
                        <small class="text-muted">You can use basic HTML formatting</small>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" class="checkbox-label">
                            <input type="checkbox" id="blogFeatured">
                            <span>Feature this article (show prominently on blog page)</span>
                        </label>
                    </div>
                    
                    <div class="viking-form-group">
                        <label class="viking-label" class="checkbox-label">
                            <input type="checkbox" id="blogPublished" checked>
                            <span>Publish immediately</span>
                        </label>
                        <small class="text-muted">Uncheck to save as draft</small>
                    </div>
                    
                    <div class="flex gap-md">
                        <button type="submit" class="btn btn-viking btn-lg">
                            <i class="fas fa-paper-plane"></i> Publish Article
                        </button>
                        <button type="button" class="btn btn-outline btn-lg" 
                                onclick="document.getElementById('createBlogModal').style.display='none'">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="../auth-handler.js"></script>
    <script src="../api-client.js"></script>
    <script src="../mock-data.js"></script>
    <!-- Load scripts.js BEFORE page-loader.js so APIClient is defined -->
    <script src="../scripts.js"></script>
    <script src="../page-loader.js"></script>
    
    <!-- Blog Page Specific Script -->
    <script>
        // Write Article Button
        document.getElementById('writeBlogBtn').addEventListener('click', function() {
            // Check if user is logged in
            const token = localStorage.getItem('mlnf_token');
            if (!token) {
                alert('Please log in to write an article.');
                window.location.href = 'auth.html';
                return;
            }
            document.getElementById('createBlogModal').style.display = 'flex';
        });
        
        // Create Blog Form Submission
        document.getElementById('createBlogForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('üöÄ Blog form submitted');
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publishing...';
            
            try {
                // Collect form data
                const title = document.getElementById('blogTitle').value.trim();
                const excerpt = document.getElementById('blogExcerpt').value.trim();
                const content = document.getElementById('blogContent').value.trim();
                const category = document.getElementById('blogCategory').value;
                const tagsInput = document.getElementById('blogTags').value.trim();
                const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];
                const featured = document.getElementById('blogFeatured').checked;
                const published = document.getElementById('blogPublished').checked;
                
                console.log('üìù Form data collected:', {
                    title,
                    excerpt: excerpt.substring(0, 50) + '...',
                    content: content.substring(0, 50) + '...',
                    category,
                    tagsCount: tags.length,
                    featured,
                    published
                });
                
                // Create slug from title
                const slug = title.toLowerCase()
                    .replace(/[^a-z0-9]+/g, '-')
                    .replace(/(^-|-$)/g, '');
                
                const postData = {
                    title,
                    slug,
                    excerpt,
                    content,
                    category,
                    tags,
                    featured,
                    published
                };
                
                console.log('üì¶ Post data prepared:', {
                    ...postData,
                    content: postData.content.substring(0, 50) + '...',
                    excerpt: postData.excerpt.substring(0, 50) + '...'
                });
                
                // Check authentication
                const token = localStorage.getItem('mlnf_token');
                console.log('üîê Auth token present:', !!token);
                if (token) {
                    console.log('üîê Token preview:', token.substring(0, 20) + '...');
                }
                
                // Make API call
                console.log('üì° Calling APIClient.blog.create...');
                const response = await APIClient.blog.create(postData);
                console.log('‚úÖ API Response:', response);
                
                // Show success message
                alert('‚úÖ Article published successfully!');
                
                // Close modal and reset form
                document.getElementById('createBlogModal').style.display = 'none';
                document.getElementById('createBlogForm').reset();
                
                // Reload blog posts
                if (typeof PageLoader !== 'undefined') {
                    console.log('üîÑ Reloading blog posts...');
                    PageLoader.loadBlog();
                }
                
            } catch (error) {
                console.error('‚ùå Error creating blog post:', error);
                console.error('‚ùå Error details:', {
                    message: error.message,
                    stack: error.stack,
                    name: error.name
                });
                
                let errorMsg = error.message || 'Please try again';
                
                // Add helpful hints based on error type
                if (errorMsg.includes('authenticate') || errorMsg.includes('logged in')) {
                    alert('‚ùå Authentication Error\n\nYou need to log in first to publish articles.\n\nClick OK to go to the login page.');
                    window.location.href = 'auth.html';
                    return;
                } else if (errorMsg.includes('validation') || errorMsg.includes('invalid')) {
                    errorMsg += '\n\nPlease check all required fields are filled correctly.';
                    alert('‚ùå Failed to publish article:\n\n' + errorMsg);
                } else {
                    alert('‚ùå Failed to publish article:\n\n' + errorMsg);
                }
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                console.log('üèÅ Form submission complete');
            }
        });
    </script>

    <!-- Blog Posts Loading Script -->
    <script>
        // Load blog posts from API
        async function loadBlogPosts(category = 'all', page = 1) {
            const blogGrid = document.getElementById('blogGrid');

            // Show loading state
            blogGrid.innerHTML = `
                <div class="skeleton-card card">
                    <div class="skeleton" style="height: 200px;"></div>
                    <div class="card-body">
                        <div class="skeleton skeleton-text" style="width: 80%;"></div>
                        <div class="skeleton skeleton-text" style="width: 60%;"></div>
                    </div>
                </div>
                <div class="skeleton-card card">
                    <div class="skeleton" style="height: 200px;"></div>
                    <div class="card-body">
                        <div class="skeleton skeleton-text" style="width: 70%;"></div>
                        <div class="skeleton skeleton-text" style="width: 50%;"></div>
                    </div>
                </div>
                <div class="skeleton-card card">
                    <div class="skeleton" style="height: 200px;"></div>
                    <div class="card-body">
                        <div class="skeleton skeleton-text" style="width: 90%;"></div>
                        <div class="skeleton skeleton-text" style="width: 40%;"></div>
                    </div>
                </div>
            `;

            try {
                const url = category === 'all'
                    ? `/api/blog?page=${page}&limit=9`
                    : `/api/blog?category=${category}&page=${page}&limit=9`;

                const response = await fetch(url);

                if (response.ok) {
                    const data = await response.json();
                    renderBlogPosts(data.posts || []);
                } else {
                    // Use sample data if API not available
                    renderSamplePosts();
                }
            } catch (error) {
                console.log('Blog API not available, using sample data');
                renderSamplePosts();
            }
        }

        function renderBlogPosts(posts) {
            const blogGrid = document.getElementById('blogGrid');

            if (posts.length === 0) {
                blogGrid.innerHTML = `
                    <div class="col-span-3 text-center" style="padding: 3rem;">
                        <i class="fas fa-feather-alt" style="font-size: 4rem; color: var(--gray-300); margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--gray-600);">No Articles Yet</h3>
                        <p class="text-muted">Be the first to share your wisdom!</p>
                        <button class="btn btn-viking mt-2" onclick="document.getElementById('writeBlogBtn').click()">
                            <i class="fas fa-pen"></i> Write the First Article
                        </button>
                    </div>
                `;
                return;
            }

            blogGrid.innerHTML = posts.map(post => `
                <article class="card blog-post-card" onclick="viewBlogPost('${post._id || post.slug}')" style="cursor: pointer; transition: all 0.3s ease;">
                    <div style="position: relative; overflow: hidden;">
                        <img src="${post.image || 'https://via.placeholder.com/400x200/4A90E2/FFFFFF?text=Blog+Post'}" alt="${post.title}" style="width: 100%; height: 180px; object-fit: cover;">
                        ${post.featured ? '<span class="badge badge-gold" style="position: absolute; top: 10px; right: 10px;">Featured</span>' : ''}
                        <span class="badge" style="position: absolute; top: 10px; left: 10px; background: var(--indigo); color: white;">${post.category || 'General'}</span>
                    </div>
                    <div class="card-body">
                        <h4 style="margin-bottom: 0.5rem; color: var(--navy); line-height: 1.3;">${post.title}</h4>
                        <p class="text-muted text-sm" style="margin-bottom: 1rem; line-height: 1.5;">${post.excerpt || post.content?.substring(0, 120) + '...'}</p>
                        <div class="flex flex-between text-sm text-muted">
                            <span><i class="fas fa-user"></i> ${post.author?.username || 'Anonymous'}</span>
                            <span><i class="fas fa-eye"></i> ${formatNumber(post.views || 0)}</span>
                        </div>
                        <div class="flex gap-md text-sm text-muted" style="margin-top: 0.5rem;">
                            <span><i class="fas fa-heart"></i> ${post.likes || 0}</span>
                            <span><i class="fas fa-comment"></i> ${post.comments?.length || 0}</span>
                            <span><i class="fas fa-clock"></i> ${formatDate(post.createdAt)}</span>
                        </div>
                    </div>
                </article>
            `).join('');

            // Add hover effects
            document.querySelectorAll('.blog-post-card').forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.style.transform = 'translateY(-8px)';
                    card.style.boxShadow = '0 12px 40px rgba(0,0,0,0.15)';
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'translateY(0)';
                    card.style.boxShadow = '';
                });
            });
        }

        function renderSamplePosts() {
            const samplePosts = [
                {
                    title: 'The Great Awakening: Why Truth Matters Now',
                    excerpt: 'In an age of information warfare, understanding the nature of truth becomes paramount for survival and freedom.',
                    category: 'Freedom',
                    author: { username: 'TruthSeeker' },
                    views: 12500,
                    likes: 342,
                    comments: { length: 89 },
                    createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    title: 'Natural Remedies: What They Don\'t Want You to Know',
                    excerpt: 'Discover the ancient healing wisdom that modern medicine has suppressed for profit.',
                    category: 'Health',
                    author: { username: 'HealerWarrior' },
                    views: 8700,
                    likes: 256,
                    comments: { length: 45 },
                    createdAt: new Date(Date.now() - 4 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    title: 'Financial Freedom: Breaking Free from the System',
                    excerpt: 'Learn how to build wealth outside the traditional banking system using crypto and alternative investments.',
                    category: 'Finance',
                    author: { username: 'CryptoViking' },
                    views: 6200,
                    likes: 189,
                    comments: { length: 32 },
                    createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    title: 'The Technology of Control: Surveillance State Exposed',
                    excerpt: 'How modern technology is being weaponized against the population and what you can do about it.',
                    category: 'Technology',
                    author: { username: 'DigitalResistance' },
                    views: 9800,
                    likes: 445,
                    comments: { length: 67 },
                    createdAt: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    title: 'Spiritual Warfare: Protecting Your Consciousness',
                    excerpt: 'Understanding the metaphysical battle for your mind and spirit in the modern age.',
                    category: 'Spirituality',
                    author: { username: 'SpiritGuide' },
                    views: 5400,
                    likes: 312,
                    comments: { length: 78 },
                    createdAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    title: 'Homeschooling Revolution: Taking Back Education',
                    excerpt: 'Why parents are withdrawing children from public schools and how to create effective learning environments.',
                    category: 'Education',
                    author: { username: 'FreedomEducator' },
                    views: 4100,
                    likes: 156,
                    comments: { length: 23 },
                    createdAt: new Date(Date.now() - 21 * 24 * 60 * 60 * 1000).toISOString()
                }
            ];

            renderBlogPosts(samplePosts);
        }

        function viewBlogPost(postId) {
            // Navigate to blog post detail page
            window.location.href = `blog-post.html?id=${postId}`;
        }

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'k';
            return num.toString();
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'Recently';
            const date = new Date(dateStr);
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
            return date.toLocaleDateString();
        }

        // Category filter buttons
        document.querySelectorAll('[data-category]').forEach(btn => {
            btn.addEventListener('click', function() {
                // Update active state
                document.querySelectorAll('[data-category]').forEach(b => {
                    b.classList.remove('active', 'btn-viking');
                    b.classList.add('btn-outline');
                });
                this.classList.add('active');
                this.classList.remove('btn-outline');

                // Load posts for category
                loadBlogPosts(this.dataset.category);
            });
        });

        // Initialize blog posts on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadBlogPosts();
        });
    </script>
    <script src="../js/site-enhancements.js"></script>
    <script src="js/mobile-viewport-handler.js"></script>
</body>
</html>